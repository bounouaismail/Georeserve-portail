<!DOCTYPE html>
<html lang="en"><!-- Basic -->
<head>
    <base target="_top">
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
   
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
 
     <!-- Site Metas -->
	 <title>Géoportail Des Parcs Nationaux</title>  
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="Image/palmicon.png" >
    <link rel="apple-touch-icon" href="Image/">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="Css/bootstrap.min.css">    
	<!-- Site CSS -->
    <link rel="stylesheet" href="Css/style.css">    
	<!-- Pickadate CSS -->
    <link rel="stylesheet" href="Css/classic.css">    
	<link rel="stylesheet" href="Css/classic.date.css">    
	<link rel="stylesheet" href="Css/classic.time.css">    
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="Css/responsive.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="Css/custom.css">

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  
	<!-- Load jQuery and PapaParse to read data from a CSV file -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>


	<title>Layers Control Tutorial - Leaflet</title>
						
	<link rel="shortcut icon" href="Image/georeserve.png" type="image/x-icon">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="Css/leaflet.css"/>
    <script src="Js/leaflet.js"></script>
    <link rel="stylesheet" href="Css/leaflet.zoomhome.css"/>
    <script src="Js/leaflet.zoomhome.min.js"></script>
	 <!-- Load Leaflet from CDN -->
	 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" crossorigin="" />
	 <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" crossorigin=""></script>
 
	 <!-- Load Esri Leaflet from CDN -->
	 <script src="https://unpkg.com/esri-leaflet@^3.0.8/dist/esri-leaflet.js"></script>
	 <script src="https://unpkg.com/esri-leaflet-vector@4.0.0/dist/esri-leaflet-vector.js"></script>
       <!-- Load ArcGIS REST JS from CDN -->
    <script src="https://unpkg.com/@esri/arcgis-rest-request@4.0.0/dist/bundled/request.umd.js"></script>
    <script src="https://unpkg.com/@esri/arcgis-rest-routing@4.0.0/dist/bundled/routing.umd.js"></script>
    <!-- Load Esri Leaflet Geocoder from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@^3.1.3/dist/esri-leaflet-geocoder.css">
    <script src="https://unpkg.com/esri-leaflet-geocoder@^3.1.3/dist/esri-leaflet-geocoder.js"></script>

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
	<!-- Start header -->
	<header class="top-navbar">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<div class="container">
				<a class="navbar-brand" href="index.html">
					<img src="images/logogeotourisme.png" alt="" />
				</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbars-rs-food" aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
				  <span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbars-rs-food">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
						<li class="nav-item"><a class="nav-link" href="about.html">Informations</a></li>
						<li class="nav-item"><a class="nav-link" href="storymap\index1.html" target="_blank">Géoportail</a> </li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="dropdown-a" data-toggle="dropdown">Cartes thématiques</a>
							<div class="dropdown-menu" aria-labelledby="dropdown-a">
								<a class="dropdown-item" href="Carte des superficies.html">Carte des superficies</a>
								<a class="dropdown-item" href="Carte NDVI.html">Carte NDVI</a>
								<a class="dropdown-item" href="Visualisation 3D.html" target="_blank">Visualisation 3D</a>
							</div>
                        </li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="dropdown-a" data-toggle="dropdown">Recherche</a>
							<div class="dropdown-menu" aria-labelledby="dropdown-a">
								<a class="dropdown-item" href="Recherche.html">Attributaires</a>
								<a class="dropdown-item" href="Recherche2.html">Spatiales</a>
								<a class="dropdown-item" href="Itinéraire.html">Itinéraire</a>
							</div>
						</li>
							<li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
	<!-- End header -->
	
	<!-- Start All Pages -->
	<div class="all-page-title page-breadcrumb">
		<div class="container text-center">
			<div class="row">
				<div class="col-lg-12">
					<h1>Itinéraire</h1>
					<br><br>
				</div>
			</div>
		</div>
	</div>
	<!-- End All Pages -->
	<div class="blog-box">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="heading-title text-center">
						<br><br>
						<p>  </p>
							<head>
							  <style>
								#map {
								  height: 500px ;
                                  width: 1000px;
								  font-family: Arial, Helvetica, sans-serif;
								  font-size: 14px;
								  color: #323232;
								  display: block;
                                  margin-left: auto;
                                  margin-right: auto;
								  padding: 100px;
                  right: 20px;
                                }

                                #directions {
        position: absolute;
        z-index: 1000;
        width: 30%;
        max-height: 50%;
        left: 50px;
        bottom: 20px;
        overflow-y: auto; /* Show a scrollbar if needed */
        background: rgb(255, 255, 255);
        font-family: Arial, Helvetica, Verdana;
        line-height: 2;
        font-size: 10px;
        padding: 50px;}
							  </style>
                         </head>
					
						    <body>
								<div id="map" class="map"></div>
							  <script>
    const map = L.map("map", {
        minZoom: 2
      })

      map.setView([29.638933, -9.665423], 5);

      const apiKey = "AAPK22b2239330f348e6856b49ba92d3aa36l-qSfkzwWqJOSvuCHty6k4cDtOREFtSJoPiRlta-1uwftZL9sBYHbKzcDXjD4ZK5";

      const basemapEnum ="ArcGIS:Streets";

      L.esri.Vector.vectorBasemapLayer(basemapEnum, {
        apiKey: apiKey
      }).addTo(map);

    var Maroc = L.esri
        .featureLayer({
          url: "https://services6.arcgis.com/f4ktY2fh4AlEsjcx/arcgis/rest/services/maroc/FeatureServer/0",
		  style: {
            color: "#000000",
            weight: 5
        }});
        Maroc.addTo(map);

    var Parc = L.esri
        .featureLayer({
          url: "https://services6.arcgis.com/f4ktY2fh4AlEsjcx/arcgis/rest/services/parc/FeatureServer/0",
		  style: {
            color: "#FFFFFF",
            weight: 5
        }});
        Parc.addTo(map);

        const searchControl = L.esri.Geocoding.geosearch({
        position: "topright",
        placeholder: "Entrez une adresse",
        useMapBounds: false,

        providers: [
          L.esri.Geocoding.arcgisOnlineProvider({
            apikey: apiKey,
            nearby: {
              lat: 29.638933,
              lng: -9.665423
            }
          })
        ]

      }).addTo(map);

      const results = L.layerGroup().addTo(map);

searchControl.on("results", (data) => {
  results.clearLayers();

  for (let i = data.results.length - 1; i >= 0; i--) {
    const marker = L.marker(data.results[i].latlng);

    const lngLatString = `${Math.round(data.results[i].latlng.lng * 100000) / 100000}, ${
      Math.round(data.results[i].latlng.lat * 100000) / 100000
    }`;
    marker.bindPopup(`<b>${lngLatString}</b><p>${data.results[i].properties.LongLabel}</p>`);

    results.addLayer(marker);

    marker.openPopup();

  }
}
)

const directions = document.createElement("div");
directions.id = "directions";
directions.innerHTML = "Click on the map to create a start and end for the route.";
document.body.appendChild(directions);

const startLayerGroup = L.layerGroup().addTo(map);
const endLayerGroup = L.layerGroup().addTo(map);

const routeLines = L.layerGroup().addTo(map);

let currentStep = "start";
let startCoords, endCoords;

function updateRoute() {
  // Create the arcgis-rest-js authentication object to use later.
  const authentication = arcgisRest.ApiKeyManager.fromKey(apiKey);

  // make the API request
  arcgisRest
    .solveRoute({
      stops: [startCoords, endCoords],
      endpoint: "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World/solve",
      authentication
    })

    .then((response) => {

      routeLines.clearLayers();
      L.geoJSON(response.routes.geoJson).addTo(routeLines);

      const directionsHTML = response.directions[0].features.map((f) => f.attributes.text).join("<br/>");
      directions.innerHTML = directionsHTML;
      startCoords = null;
      endCoords = null;

    })

    .catch((error) => {
      console.error(error);
      alert("There was a problem using the route service. See the console for details.");
    });

}

map.on("click", (e) => {
  const coordinates = [e.latlng.lng, e.latlng.lat];

  if (currentStep === "start") {

    startLayerGroup.clearLayers();
    endLayerGroup.clearLayers();
    routeLines.clearLayers();

    L.marker(e.latlng).addTo(startLayerGroup);
    startCoords = coordinates;

    currentStep = "end";
  } else {

    L.marker(e.latlng).addTo(endLayerGroup);
    endCoords = coordinates;

    currentStep = "start";
  }

  if (startCoords && endCoords) {
    updateRoute();
  }

});

</script>
							  
	<a href="#" id="back-to-top" title="Back to top" style="display: none;">&uarr;</a>

	<!-- ALL JS FILES -->
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
    <!-- ALL PLUGINS -->
	<script src="js/jquery.superslides.min.js"></script>
	<script src="js/images-loded.min.js"></script>
	<script src="js/isotope.min.js"></script>
	<script src="js/form-validator.min.js"></script>
    <script src="js/contact-form-script.js"></script>
    <script src="js/custom.js"></script>
</body>
</html>